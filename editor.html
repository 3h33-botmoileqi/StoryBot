<html class="fontawesome-i2svg-active fontawesome-i2svg-complete">
	<head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <title>StoryBot</title>
	    <!-- Bootstrap CSS CDN -->
	    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
	    <!-- jQuery UI -->
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css" integrity="sha256-p6xU9YulB7E2Ic62/PX+h59ayb3PBJ0WFTEQxq0EjHw=" crossorigin="anonymous" />
	    <!-- Our Custom CSS -->
	    <link rel="stylesheet" href="style.css">
	    <!-- Quill CSS -->
	    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
	    <!-- Tempus Dominus css -->
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0-alpha14/css/tempusdominus-bootstrap-4.min.css" />
	    <!-- CodeMirror -->
	   	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/codemirror.css" integrity="sha256-o/v/5fOniPHMAww4EAIfRBFV0SeoqksPrY0Yq5x+wSM=" crossorigin="anonymous" />
	   	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror-colorpicker@1.9.50/dist/codemirror-colorpicker.css" integrity="sha256-AJQh3P7c9UKLzfjuwPCS9aovafSQjn8iWXt9rpmvW5g=" crossorigin="anonymous">
			<!-- Firebase -->
			<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
			<!-- Dropzone -->
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/dropzone.css" integrity="sha256-0Z6mOrdLEtgqvj7tidYQnCYWG3G2GAIpatAWKhDx+VM=" crossorigin="anonymous" />
	</head>
	<body data-__gyazo-extension-added-paste-support="true">
	  <div id="content">
      <nav class="navbar navbar-expand-lg sticky-top navbar-light bg-light">
				<a class="navbar-return" href="./"><i class="fas fa-chevron-left"></i></a>
				<a class="navbar-brand" href="#"></a>
			  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			    <span class="navbar-toggler-icon"></span>
			  </button>
			  <div class="collapse navbar-collapse" id="navbarSupportedContent">
			    <ul class="navbar-nav mr-auto">
			      <!-- <li class="nav-item active">
			        <a class="nav-link navbar-brand" href="#">New Story<span class="sr-only">(current)</span></a>
			      </li> -->
						<div class="navbar-separator"></div>
			      <li class="nav-item">
			        <a class="nav-link" href="#visual" onclick="changePanel('#chatPanel');editor.StartStoryEditor();">Visualisation</a>
			      </li>
						<div class="navbar-separator"></div>
			      <li class="nav-item">
			        <a class="nav-link" href="#conversation" onclick="changePanel('#messagePanel');">Conversation</a>
			      </li>
						<div class="navbar-separator"></div>
			      <li class="nav-item">
			        <a class="nav-link" href="#personnges" onclick="changePanel('#characterPanel');">Personnages</a>
			      </li>
						<div class="navbar-separator"></div>
			      <li class="nav-item">
			        <a class="nav-link" href="#config" onclick="changePanel('#configPanel');editor.loadConfig();">Paramètrage</a>
			      </li>
			    </ul>
					<ul class="navbar-nav ml-auto">
						<li class="nav-item">
							<a class="nav-link" href="#" onclick="editor.saveStory(function(){alert('Story Sauvegardé');})"><button class="btn btn-success">Sauvegarder <i class="fas fa-save"></i></button></a>
						</li>
					</ul>
			  </div>
          <!-- <div class="container-fluid">
						<button class="btn btn-primary"><i class="fas fa-chevron-left"></i></button>
              <button class="btn btn-dark d-inline-block d-lg-none ml-auto collapsed" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <svg class="svg-inline--fa fa-align-justify fa-w-14" aria-hidden="true" data-prefix="fas" data-icon="align-justify" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M0 84V44c0-8.837 7.163-16 16-16h416c8.837 0 16 7.163 16 16v40c0 8.837-7.163 16-16 16H16c-8.837 0-16-7.163-16-16zm16 144h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 256h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0-128h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg>
              </button>
              <div class="collapse width editor-toolbar justify-content-end" id="navbarSupportedContent" style="display:none;">
              	<div id="switchPreview">
              		<label style="vertical-align:bottom;">Prévisualisation</label>
                	<label class="switch">
									  <input id="viewMode" type="checkbox" onchange="editor.changeViewMode(this.checked);">
									  <span class="slider round"></span>
									</label>
              	</div>
              	<div class="btn-group">
                	<button type="button" class="btn btn-info buttonPage" onclick="editor.changePanel('#messagePanel');"><i class="fas fa-comments"></i></button>
                	<button type="button" class="btn btn-info buttonPage" onclick="editor.changePanel('#characterPanel');"><i class="fas fa-users"></i></button>
                </div>
              	<div class="btn-group">
                	<button type="button" class="btn btn-info buttonPage" onclick="editor.changePanel('#chatPanel');editor.StartStoryEditor();"><i class="fas fa-eye"></i></button>
                	<button type="button" class="btn btn-info buttonPage" onclick="editor.changePanel('#configPanel');editor.loadConfig();"><i class="fas fa-cogs"></i></button>
              	</div>
                <button type="button" class="btn btn-info buttonPage" onclick="login == null ? editor.changePanel('#loginPanel') : saveStory(login)"><i class="fas fa-save"></i></button>
              	<div class="btn-group">
                	<button type="button" class="btn btn-info buttonPage" onclick="login == null ? editor.changePanel('#loginPanel') : $(function(){editor.changePanel('#cloudPanel');loadStories(login);})"><i class="fas fa-cloud-upload-alt"></i></button>
                	<button type="button" class="btn btn-info buttonPage" onclick="editor.changePanel('#sharePanel');"><i class="fas fa-share-alt"></i></button>
              	</div>
          		</div>
          </div> -->
      </nav>
      <div id="mainContent">
      	<div id="chatPanel" class="page" style="display: none;">
					<div id="switchPreview">
						<label style="vertical-align:bottom;margin-right:5px">Aperçu lecture</label>
						<label class="switch">
							<input id="viewMode" type="checkbox" onchange="editor.changeViewMode(this.checked);">
							<span class="slider round"></span>
						</label>
					</div>
        	<ul id="chat" style="/*background:grey;width:100%;height:3000px*/"></ul>
        	<i id="tapeLogo" class="fas fa-hand-point-up" style="display: none;"></i>
					<audio id="notifAudio" ><source src="https://firebasestorage.googleapis.com/v0/b/storybot-68a04.appspot.com/o/definite.ogg?alt=media&token=1d18c898-e99d-41b8-a790-f3ca6d9b4f87" type="audio/ogg"></source></audio>
    		</div>
  			<div  id="messagePanel" class="page messageListContainer" style="display: none;">
  				<div  class="d-flex" style="margin-bottom: 1vh">
  					<input type="text" name="messageFilter" placeholder="Recherche..." style="width: 100%">
	  				<button class="btn-dark" onclick="editor.LoadSelectedMessage(editor.conversation.length, true);"><i class="fas fa-plus"></i></button>
  				</div>
  				<ul id="messageList" class="list-group">

  				</ul>
  			</div>
  			<div class="page messageFormContainer" style="display: none;">
  				<div class="exitPanel"><button class="btn btn-danger" onclick="$('.messageListContainer').show();$('.messageFormContainer').hide();"><i class="fas fa-times"></i></button></div>
      		<form name="messageForm" onsubmit="editor.messageFormSubmit();return false;">
      			<input type="text" name="messageId" hidden>
      			<input type="checkbox" name="isNew" hidden>
      			<div class="form-row form-group">
      				<label>Personnage : </label>
      				<select class="form-control characterList" name="character" onchange="document.forms['messageForm']['side'].value = editor.characters[this.value].defaultSide" required style="max-width: 50vw"></select>
  						<button class="btn-dark" onclick="editor.LoadSelectedCharacter(null, true);return false;"><i class="fas fa-plus"></i></button>
      			</div>
  					<div class="form-group row">
  						<div class="col">
      					<label>Coté du chat :</label>
      					<div class="form-check form-check-inline">
								  <input class="form-check-input" type="radio" name="side" value="left">
								  <label class="form-check-label" for="inlineRadio1">Gauche</label>
								</div>
								<div class="form-check form-check-inline">
								  <input class="form-check-input" type="radio" name="side" value="right">
								  <label class="form-check-label" for="inlineRadio2">Droit</label>
								</div>
							</div>
							<div class="col">
	        					<label>Contenu :</label>
	        					<div class="form-check form-check-inline">
								  <input class="form-check-input" type="radio" name="content" value="text" onclick="$('#mediaPayload').hide();$('#textPayload').show()">
								  <label class="form-check-label" for="inlineRadio1">Texte</label>
								</div>
								<div class="form-check form-check-inline">
								  <input class="form-check-input" type="radio" name="content" value="media" onclick="$('#mediaPayload').show();$('#textPayload').hide()">
								  <label class="form-check-label" for="inlineRadio2">Media</label>
								</div>
							</div>
						</div>
						<div id="textPayload" class="form-group">
  						<div id="message-Editor" class="form-control" style="height: 25vh"></div>
  					</div>
  					<div id="mediaPayload" class="form-group" style="display: none">
    					<label>Type :</label>
    					<div class="form-check form-check-inline">
							  <input class="form-check-input" type="radio" name="payload-type" value="image">
							  <label class="form-check-label" for="inlineRadio1">Image</label>
							</div>
							<div class="form-check form-check-inline">
							  <input class="form-check-input" type="radio" name="payload-type" value="video">
							  <label class="form-check-label" for="inlineRadio2">Video</label>
							</div>
							<div class="form-check form-check-inline">
							  <input class="form-check-input" type="radio" name="payload-type" value="audio">
							  <label class="form-check-label" for="inlineRadio3">Audio</label>
							</div>
							<div class="row">
								<div class="col form-group">
									<label>URL :</label>
									<input type="text" name="payload-url">
								</div>
								<div class="col form-group dropzone" id="MessageDropzone">
								</div>
							</div>
						</div>
  					<div class="form-group">
							<label>Date & Heure :</label>
              <div class="input-group date" id="datetimepicker1" data-target-input="nearest">
                  <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker1" name="datetime"/>
                  <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                      <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                  </div>
              </div>
  					</div>
						<div class="row">
							<div class="col form-group">
								<label for="formControlRange">Délai (seconde): </label>
								<input type="number" id="delayOutput" class="form-control" name="delay" min="0">
								<input type="range" class="form-control-range" id="delayInput"oninput="delayOutput.value = delayInput.value" value="0" min="0" max="60">
	        					<div class="form-group form-check">
								  <input class="form-check-input" type="checkbox" value="" id="defaultCheck1" name="tapeFlag">
								  <label class="form-check-label" for="defaultCheck1">
								  	Touch pour continuer
								  </label>
								</div>
								<div class="form-group form-check">
								  <input class="form-check-input" type="checkbox" value="" id="defaultCheck2" name="adsFlag">
								  <label class="form-check-label" for="defaultCheck2">
								    Avertissement placement de produit
								  </label>
								</div>
							</div>
							<div class="col form-group">
									<label>Animation :</label>
									<textarea  id="animationsEditor"></textarea>
							</div>
						</div>
						<div class="d-flex  flex-row-reverse">
							<button type="submit" class="btn btn-primary">Enregistrer</button>
						</div>
      		</form>
  			</div>
  			<div id="characterPanel" class="page characterListContainer" style="display: none;">
  				<div  class="d-flex" style="margin-bottom: 1vh">
  					<input type="text" name="characterFilter" placeholder="Recherche..." style="width: 100%">
	  				<button class="btn-dark" onclick="editor.LoadSelectedCharacter(null, true);"><i class="fas fa-plus"></i></button>
  				</div>
  				<ul id="mainCharacterList" class="list-group characterList"></ul>
  			</div>
  			<div class="page characterFormContainer" style="display: none;">
  				<div class="exitPanel"><button class="btn btn-danger" onclick="$('.characterListContainer').show();$('.characterFormContainer').hide();"><i class="fas fa-times"></i></button></div>
  				<form name="characterForm" onsubmit="editor.characterFormSubmit();return false;">
      			<input type="text" name="characterName" hidden>
      			<input type="checkbox" name="isNew" hidden>
  					<div class="form-group">
    					<label>Nom:</label>
    					<input type="text" name="name" class="form-control">
    					<label>Avatar :</label>
    					<input type="text" name="avatar" class="form-control" >
							<div class="dropzone" id="CharacterDropzone">
							</div>
    					<label>Video :</label>
    					<input type="text" name="video" class="form-control" >
						</div>
						<div id="textPayload" class="form-group">
  						<div id="charDesc-editor" class="form-control" style="height: 25vh"></div>
  					</div>
  					<div class="form-group">
    					<label>Coté du chat :</label>
    					<div class="form-check form-check-inline">
							  <input class="form-check-input" type="radio" name="defaultSide" value="left" required>
							  <label class="form-check-label" for="inlineRadio1">Gauche</label>
							</div>
							<div class="form-check form-check-inline">
							  <input class="form-check-input" type="radio" name="defaultSide" value="right" required>
							  <label class="form-check-label" for="inlineRadio2">Droit</label>
							</div>
						</div>
						<button type="submit" class="btn btn-primary">Enregistrer</button>
  				</form>
  			</div>
        <div id="configPanel" class="page" style="display: none;">
        	<form name="configForm" onsubmit="editor.configFormSubmit();return false;">
        		<div class="form-group">
        			<label>Nom de la Story :</label>
        			<input type="text" name="storyName">
							<div class="form-check">
								<input class="form-check-input" type="checkbox" name="isPublish">
								<label>Publier</label>
							</div>
	        		<div class="form-check">
		        		<input class="form-check-input" type="checkbox" name="displaycharacterAvatar">
	        			<label>Afficher les avatars des personnage</label>
		        	</div>
	        		<div class="form-check">
		        		<input class="form-check-input" type="checkbox" name="displaycharacterName">
	        			<label>Afficher les nom des personnage</label>
	        		</div>
	        		<div class="form-check">
		        		<input class="form-check-input" type="checkbox" name="displayMessageDate">
	        			<label class="form-check-label">Afficher les dates des messages</label>
	        		</div>
        		</div>
  					<div class="form-group">
    					<label>Pub chaque X Messages :</label>
    					<div class="form-check form-check-inline">
							  <input class="form-check-input" type="radio" name="adsFlag" value="true" onchange="$('#adsConfig').show();">
							  <label class="form-check-label" for="inlineRadio1">Oui</label>
							</div>
							<div class="form-check form-check-inline">
							  <input class="form-check-input" type="radio" name="adsFlag" value="false" onchange="$('#adsConfig').hide();" checked="true">
							  <label class="form-check-label" for="inlineRadio2">Non</label>
							</div>
							<div id="adsConfig" style="display: none;">
			        			<label for="formControlRange">Chaque <output id="adsEachMessagesOutput">1</output> messages</label>
								<input type="range" class="form-control-range" id="adsEachMessagesInput" name="adsEachMessages" oninput="adsEachMessagesOutput.value = adsEachMessagesInput.value" value="1" min="1" max="100">
							</div>
						</div>
						<div id="authorsForm" class="form-group">
							<label>Liste des auteurs</label>
							<div  class="d-flex">
	        					<input type="text" id="authorAdd" name="authorAdd" placeholder="Ajouter..." style="width: 100%">
	        					<button class="btn-dark" onclick="editor.AddAuthor($('#authorAdd').val().toLowerCase());$('#authorAdd').val('');"><i class="fas fa-plus"></i></button>
      				</div>
							<ul id="authorsList" class="list-group authorsList"></ul>
						</div>
						<input class="btn btn-primary" type="submit" name="configSubmit">
        	</form>
        	<div style="position: absolute;right: 5vw;bottom: 5vh;">
        		<input type="file" id ="excelInput" name="excel" oninput="parseExcel(this.files[0]);" hidden>
        		<button class="btn btn-primary" style="margin-right: 1vw" onclick="$('#excelInput').trigger('click');">Import Excel <i class="fas fa-file-excel"></i></button>
      			<button class="btn btn-primary" onclick="changePanel('#cssPanel');CodeMirrorCustomCSS.refresh();CodeMirrorCustomCSS.setValue(editor.config.customCSS);">CSS Personalisé <i class="fas fa-file-code"></i></button>
      		</div>
        </div>
      	<div id="cssPanel" class="page" style="display:none">
  				<div class="exitPanel"><button class="btn btn-danger" onclick="changePanel('#configPanel')"><i class="fas fa-times"></i></button></div>
  				<div class="d-flex">
  					<ul id='example' style="width: 50vw;height: 85vh;">
  						<li class="messagesGroup">
			    			<div class="messagesGroup-header header-left">
			    				<div>
			    					<img class="avatar" src="https://cdn.iconscout.com/icon/free/png-256/avatar-380-456332.png"/>
			    					<h6>Jean Dupont</h6>
			    				</div>
			    			</div>
			    			<ul>
			    				<li class="message message-left">
										<div class="message-container">
											<div class="text">Ceci est un text d'exemple</div>
											<div class="Date">12:00</div>
										</div>
									</li>
			    			</ul>
			        </li>
			        <li class="messagesGroup">
			    			<div class="messagesGroup-header header-right">
			    				<div>
			    					<img class="avatar" src="https://cdn.iconscout.com/icon/free/png-256/avatar-380-456332.png"/>
			    					<h6>Jean Dupont</h6>
			    				</div>
			    			</div>
			    			<ul>
			    				<li class="message message-right">
										<div class="message-container">
											<div class="text">Ceci est un text d'exemple</div>
											<div class="Date">12:00</div>
										</div>
									</li>
			    			</ul>
			        </li>
			        <button class="btn btn-primary" style="position:absolute;bottom: 5vh;" onclick="$('#example .messagesGroup').hide();setTimeout(function(){$('#example .messagesGroup').show();},500)"><i class="fas fa-sync"></i></button>
  					</ul>
  					<div id="customCSS"><!--editor.loadCSS(this.value)-->
  						<textarea id="cssEditor"></textarea>
  					</div>
  				</div>
      	</div>
      	<div id="cloudPanel" class="page" style="display:none">
      		<div  class="d-flex">
  					<input type="text" name="storyFilter" placeholder="Recherche..." style="width: 100%">
  					<button class="btn-dark" onclick="loadStoryConfirm(null)"><i class="fas fa-plus"></i></button>
  				</div>
					<ul id="storiesList" class="list-group"></ul>
      	</div>
      	<div id="sharePanel" class="page" style="display:none">
      		<h1><i class="fas fa-wrench"></i> En construction <i class="fas fa-wrench"></i></h1>
      	</div>
			</div>
  	</div>
    <div  id="characterModal" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
		  <div class="modal-dialog modal-lg">
		    <div class="modal-content">
		    	<div style="padding: 20px">
			    	<div class="messagesGroup-header header-left">
	    				<div>
	    					<img class="avatar" src=""/>
	    					<h6 id="characterName"></h6>
	    				</div>
    				</div>
    				<br/>
			    	<div>
			    		<p id="description">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
			    	</div>
			    	<div style="text-align: center;">
			    		<video id="characterVideo" controls autoplay muted src="" style="width: 25vw">
			    			Your browser does not support the video tag.
			    		</video>
			    	</div>
		    	</div>
		    </div>
		  </div>
		</div>
    <!-- jQuery CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <!-- jQuery UI -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha256-KM512VNnjElC30ehFwehXjx1YCHPiQkOPmqnrWtpccM=" crossorigin="anonymous"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <!-- Quill JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.6/quill.min.js" integrity="sha256-3oYBiGm16EW9wQH8G1VhGh43XgivbO5KaB10RhA9phE=" crossorigin="anonymous"></script>
    <!-- Moment JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/locale/fr.js" integrity="sha256-D0tqyrTQHDExvGYoi+kyInjV47fm30M5qq4whUrMuuE=" crossorigin="anonymous"></script>
    <!-- Tempus Dominus JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0-alpha14/js/tempusdominus-bootstrap-4.min.js"></script>
    <!-- Socket.io JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
    <!-- Font Awesome JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/js/solid.min.js" integrity="sha256-Qg/zzHQm2attQOH1sZs94E2AbUdFQmR9RuKbnExYRe0=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/js/fontawesome.min.js" integrity="sha256-KZjyrvXj0bZPo6kaV2/gP3h2LXakV/QALQ6UmBhzqD0=" crossorigin="anonymous"></script>
    <!-- CodeMirror-->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.46.0/codemirror.min.js" integrity="sha256-OMbqhJ5GYA+UQ2a9UE9iXHA1kn3hlZCFL5aZmpSp/+M=" crossorigin="anonymous"></script>    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/mode/javascript/javascript.js" integrity="sha256-Wyfz01iV9zeqL2igt5tF1xuVBaRZJhsd/6N9Ap/i5sU=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/mode/css/css.js" integrity="sha256-X/teJqHXUccfWWBeziAxGjeC7jl07Gaw/FkzK78UMs0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/edit/closebrackets.js" integrity="sha256-J+IeaQd1P4WqdI6BNbLIiQ8QuzlexywhSmLrFd4H2g0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror-colorpicker@1.9.50/dist/codemirror-colorpicker.min.js" integrity="sha256-xpnjpF/9oKFV6YX0FcvYp7rk+FgsPVMD0JjB1evfpys=" crossorigin="anonymous"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-firestore.js"></script>
		<script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-storage.js"></script>
		<script src="https://www.gstatic.com/firebasejs/ui/3.6.0/firebase-ui-auth__fr.js"></script>
    <!-- Excel Reader -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.2.0/jszip.min.js" integrity="sha256-VwkT6wiZwXUbi2b4BOR1i5hw43XMzVsP88kpesvRYfU=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.14.3/xlsx.min.js" integrity="sha256-/YsIw0C9o5pLqqgKbSVgGl2a37ar8yIPHSkdeWbOcq4=" crossorigin="anonymous"></script>
		<!-- Dropzone -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/dropzone.js" integrity="sha256-awEOL+kdrMJU/HUksRrTVHc6GA25FvDEIJ4KaEsFfG4=" crossorigin="anonymous"></script>
    <script src="commun.js"></script>
    <script src="message.js"></script>
    <script src="story.js"></script>
    <script src="editor.js"></script>
    <script src="thirdParty.js"></script>
		<script>
			let editor = new Editor();
			var id;
			$(document).ready(function () {
					firebase.auth().onAuthStateChanged(function(user) {
						id = findGetParameter("id");
						//est ce que l'utilisateur est connecté et la clé de la story a charger est retrouvé
						if (user && id != null) {
							db.collection('stories').doc(id).get().then((doc) => {//On essai de recupèrer la story
								//si elle existe bien
								if(doc.exists){
									//si la personne en question a le droit d'éditer la story
									if(doc.data().authors.findIndex(ref => ref === user.uid) != -1){
										// editor.loadStory(doc);
										  editor.loadStoryEditor(doc.id, doc.data());
											//Load story name
											document.title = editor.name+" - StoryBot";
										  $(".navbar-brand").text(editor.name);
										  //link css editor with custom css
										  if(editor.config['customCSS']){
										    CodeMirrorCustomCSS.setValue(editor.config['customCSS']);
											}
										  localStorage["lastStory"] = doc.id;
										  changePanel("#chatPanel");
										  editor.StartStoryEditor();
									}else{
										//l'Utilisateur ne dispose pas de l'accès
										alert("Vous ne disposez pas d'accès d'auteur pour cette story");
										window.location.replace(window.location.origin);
									}
								}else{
									//clé de la story introuvable dans la base
									alert("Story Introuvable");
									window.location.replace(window.location.origin);
								}
							})
							.catch(err => {
								console.log('Error getting documents', err);
							});
						} else {
							// Not connected
							alert("Vous devez être connecté pour editer une story");
							window.location.replace(window.location.origin);
						}
					});
			});

			$(window).bind('keydown', function(event) {
		    if (event.ctrlKey || event.metaKey) {
	        switch (String.fromCharCode(event.which).toLowerCase()) {
	        case 's':
	            event.preventDefault();
					    editor.saveStory(function(){alert('Story Sauvegardé');})
	            break;
	        }
		    }
			});
		</script>
	</body>
</html>
